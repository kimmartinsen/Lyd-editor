// Region events
      let isCreatingRegion = false;
      
      state.regions.on('region-created', (region) => {
        region.setOptions({ color: 'rgba(239, 68, 68, 0.3)' });
        saveUndoState();
        updateRegionsInfo();
        isCreatingRegion = false;
      });

      state.regions.on('region-updated', () => {
        updateRegionsInfo();
      });

      state.regions.on('region-removed', () => {
        updateRegionsInfo();
      });

      state.regions.on('region-clicked', (region, e) => {
        e.stopPropagation();
        if (e.shiftKey) {
          region.remove();
          saveUndoState();
        }
      });

      // Enable region drawing
      state.regions.enableDragSelection({
        color: 'rgba(239, 68, 68, 0.3)'
      });

      // Prevent region creation from interfering with playback
      state.wavesurfer.on('interaction', () => {
        if (state.isPlaying) {
          // Allow seeking during playback, but don't create regions
          isCreatingRegion = true;
        }
      });
